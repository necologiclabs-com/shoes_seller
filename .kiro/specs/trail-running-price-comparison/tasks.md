# Implementation Plan

- [x] 1. プロジェクト初期化とインフラストラクチャ基盤の構築
  - AWS CDK プロジェクトを初期化し、DynamoDB テーブル、API Gateway、基本的な Lambda 関数のスタックを定義する
  - TypeScript 設定、ESLint、Prettier を含む開発環境を構成する
  - _Requirements: 7.1, 7.3, 7.5_

- [x] 2. DynamoDB データモデルとユーティリティの実装
  - [x] 2.1 DynamoDB テーブル定義と CDK スタックの作成
    - シングルテーブル設計で PriceComparisonTable を定義する（PK、SK、GSI1 を含む）
    - CDK コードでテーブルとインデックスをプロビジョニングする
    - _Requirements: 7.3_

  - [x] 2.2 データアクセスレイヤーとエンティティマッパーの実装
    - Product、Price、AffiliateConfig エンティティの TypeScript インターフェースを作成する
    - DynamoDB 操作用のヘルパー関数（put、get、query、scan）を実装する
    - エンティティと DynamoDB アイテム間の変換ロジックを実装する
    - _Requirements: 1.1, 2.2, 4.1_

-

- [x] 3. 商品管理 Lambda 関数の実装
  - [x] 3.1 GetProductsFunction（商品一覧取得）の実装
    - DynamoDB から商品をスキャン/クエリする Lambda ハンドラーを作成する
    - ページネーション機能を実装する（nextToken サポート）
    - ブランドとカテゴリーでのフィルタリングを実装する
    - _Requirements: 1.2, 1.3_

  - [x] 3.2 GetProductDetailFunction（商品詳細取得）の実装
    - productId で単一商品を取得する Lambda ハンドラーを作成する
    - 商品が見つからない場合の 404 エラーハンドリングを実装する
    - _Requirements: 1.3, 1.4_

  - [x] 3.3 API Gateway エンドポイントと Lambda 統合の設定
    - GET /products と GET /products/{productId}の API ルートを定義する
    - CORS 設定を構成する
    - Lambda 関数を API エンドポイントに接続する
    - _Requirements: 7.5_

- [x] 4. 価格取得 Lambda 関数の実装
  - [x] 4.1 GetPricesFunction（キャッシュされた価格データ取得）の実装
    - 特定商品の全プラットフォームの価格データをクエリする Lambda ハンドラーを作成する
    - 価格データを構造化されたレスポンスにフォーマットする
    - 最終更新タイムスタンプを含める
    - _Requirements: 2.2, 3.1, 3.5_

  - [x] 4.2 API Gateway エンドポイントと Lambda 統合の設定
    - GET /products/{productId}/prices の API ルートを定義する
    - Lambda 関数をエンドポイントに接続する
    - _Requirements: 7.5_

- [x] 5. アフィリエイトリンク生成ユーティリティの実装
  - [x] 5.1 各プラットフォームのアフィリエイト URL 生成関数の作成
    - Amazon、楽天、ヨドバシ、メルカリのアフィリエイト URL ビルダーを実装する
    - 各プラットフォームの規約に準拠した URL 形式を確保する
    - _Requirements: 4.2, 4.3_

  - [x] 5.2 Systems Manager Parameter Store からのアフィリエイト設定読み込み
    - Parameter Store からアフィリエイト設定を取得する関数を実装する
    - 設定のキャッシングメカニズムを実装する
    - _Requirements: 4.1, 4.4_

  - [x] 5.3 GetPricesFunction にアフィリエイトリンク生成を統合
    - 価格レスポンスに affiliateUrl フィールドを追加する
    - 各プラットフォームの適切なアフィリエイト URL を生成する
    - _Requirements: 4.2_

- [x] 6. 価格スクレイピング/API 統合サービスの実装
  - [x] 6.1 Amazon 価格取得サービスの実装
    - Amazon PA-API 5.0 統合を実装する
    - 商品検索と ASIN 解決ロジックを実装する
    - 価格、在庫状況、商品 URL を抽出する
    - エラーハンドリングとリトライロジックを実装する
    - _Requirements: 2.1, 2.2, 2.5_

  - [x] 6.2 楽天価格取得サービスの実装
    - 楽天商品検索 API 統合を実装する
    - 商品検索とマッチングロジックを実装する
    - 価格、在庫状況、商品 URL を抽出する
    - エラーハンドリングとリトライロジックを実装する
    - _Requirements: 2.1, 2.2, 2.5_

  - [x] 6.3 ヨドバシ価格取得サービスの実装（Web スクレイピング）
    - Puppeteer/Playwright を使用したスクレイピングロジックを実装する
    - 商品検索とページナビゲーションを実装する
    - 価格、在庫状況、商品 URL を抽出する
    - タイムアウトとエラーハンドリングを実装する
    - _Requirements: 2.1, 2.2, 2.5_

  - [x] 6.4 メルカリ価格取得サービスの実装（Web スクレイピング）
    - Web スクレイピングまたは非公式 API 統合を実装する
    - 商品検索とマッチングロジックを実装する
    - 価格、在庫状況、商品 URL を抽出する
    - エラーハンドリングとリトライロジックを実装する
    - _Requirements: 2.1, 2.2, 2.5_

- [x] 7. 価格更新 Lambda 関数とスケジューラーの実装
  - [x] 7.1 UpdatePricesFunction（定期価格更新）の実装
    - DynamoDB から全商品を取得するロジックを実装する
    - 各商品に対して全プラットフォームの価格サービスを並列呼び出しする
    - 取得した価格データで DynamoDB を更新する
    - 失敗したプラットフォームのエラーを記録する
    - _Requirements: 2.1, 2.4, 2.5, 6.1, 6.2_

  - [x] 7.2 EventBridge Scheduler ルールの設定
    - 6 時間ごとに UpdatePricesFunction をトリガーする EventBridge ルールを作成する
    - Lambda 関数にスケジューラー権限を付与する
    - _Requirements: 2.4, 6.1_

- [x] 8. フロントエンドプロジェクトのセットアップ
  - [x] 8.1 Vite + React + TypeScript プロジェクトの初期化
    - Vite を使用して React プロジェクトを作成する
    - TypeScript 設定を構成する
    - ESLint、Prettier を設定する
    - _Requirements: 8.1, 8.4_

  - [x] 8.2 TailwindCSS と UI ライブラリのセットアップ
    - TailwindCSS をインストールして設定する
    - 基本的なデザインシステム（色、タイポグラフィ、スペーシング）を定義する
    - _Requirements: 5.1_

  - [x] 8.3 React Router と React Query のセットアップ
    - React Router をインストールして基本ルートを設定する
    - React Query をセットアップしてサーバー状態管理を行う
    - API クライアント設定を作成する
    - _Requirements: 8.2, 8.3_

- [x] 9. 共通 UI コンポーネントの実装
  - [x] 9.1 Loading コンポーネントの作成
    - スピナーとスケルトンローディング状態を実装する
    - _Requirements: 5.3, 5.4_

  - [x] 9.2 ErrorMessage コンポーネントの作成
    - エラー表示とリトライボタンを実装する
    - _Requirements: 5.3_

  - [x] 9.3 Header コンポーネントの作成
    - サイトロゴとナビゲーションを実装する
    - レスポンシブモバイルメニューを実装する
    - _Requirements: 5.1_

- [x] 10. ProductList コンポーネントとページの実装
  - [x] 10.1 ProductCard コンポーネントの作成
    - 商品画像、名前、モデル番号を表示する
    - 商品詳細ページへのリンクを実装する
    - レスポンシブカードレイアウトを実装する
    - _Requirements: 1.3, 5.1_

  - [x] 10.2 ProductList コンポーネントの実装
    - GET /products API を使用して商品を取得する
    - グリッドレイアウトで商品を表示する
    - ローディングとエラー状態を処理する
    - 商品が見つからない場合のメッセージを表示する
    - _Requirements: 1.2, 1.3, 1.4, 5.1_

  - [x] 10.3 ホームページの作成
    - ProductList コンポーネントを統合する
    - ページタイトルと説明を追加する
    - _Requirements: 1.2_

- [x] 11. PriceComparison コンポーネントの実装
  - [x] 11.1 PlatformCard コンポーネントの作成
    - プラットフォームロゴと名前を表示する
    - 価格を通貨フォーマットで表示する
    - 在庫状況を表示する
    - アフィリエイトリンクボタンを実装する
    - 最安値の視覚的ハイライトを実装する
    - _Requirements: 3.1, 3.2, 3.3, 4.2_

  - [x] 11.2 PriceComparison コンポーネントの実装
    - GET /products/{productId}/prices API を使用して価格を取得する
    - 4 つのプラットフォームの価格を比較表形式で表示する
    - 最安値を計算してハイライトする
    - 節約可能額を計算して表示する
    - 最終更新タイムスタンプを表示する
    - ローディングとエラー状態を処理する
    - _Requirements: 2.3, 3.1, 3.2, 3.3, 3.4, 3.5_

- [x] 12. ProductDetail ページの実装
  - [x] 12.1 ProductDetail コンポーネントの作成
    - GET /products/{productId} API を使用して商品詳細を取得する
    - 商品画像、名前、モデル番号を表示する
    - 公式製品リンクを表示する
    - PriceComparison コンポーネントを埋め込む
    - 商品が見つからない場合の 404 状態を処理する
    - _Requirements: 1.3, 3.1_

  - [x] 12.2 ルーティングとナビゲーションの設定
    - /products/{productId}ルートを設定する
    - ProductList から ProductDetail へのナビゲーションを実装する
    - _Requirements: 1.3_

-

- [x] 13. レスポンシブデザインとアクセシビリティの実装
  - [x] 13.1 全コンポーネントのレスポンシブレイアウトの実装
    - モバイル、タブレット、デスクトップのブレークポイントを実装する
    - タッチフレンドリーなインタラクション要素を確保する
    - _Requirements: 5.1_

  - [x] 13.2 アクセシビリティ機能の実装
    - 適切な ARIA ラベルとロールを追加する
    - キーボードナビゲーションを実装する
    - 十分な色コントラストを確保する
    - _Requirements: 5.5_

-

- [x] 14. フロントエンドデプロイメントインフラの構築
  - [x] 14.1 S3 バケットと CloudFront CDK スタックの作成
    - 静的ホスティング用の S3 バケットを作成する
    - CloudFront ディストリビューションを設定する
    - カスタムドメインと SSL 証明書を設定する（オプション）
    - _Requirements: 7.1, 7.5_

  - [x] 14.2 ビルドとデプロイスクリプトの作成
    - プロダクションビルドスクリプトを作成する
    - S3 へのデプロイスクリプトを作成する
    - CloudFront キャッシュ無効化を実装する
    - _Requirements: 8.5_

- [x] 15. 初期商品データのシード
  - [x] 15.1 サロモン商品データのシードスクリプトの作成
    - サロモンのトレイルランニングシューズの初期商品リストを定義する
    - DynamoDB に商品を挿入するスクリプトを作成する
    - 商品画像と公式 URL を含める
    - _Requirements: 1.1_

  - [x] 15.2 シードスクリプトの実行とデータ検証
    - 開発環境でシードスクリプトを実行する
    - 商品が正しく保存されたことを確認する
    - _Requirements: 1.1_

- [x] 16. エンドツーエンド統合とテスト
  - [x] 16.1 完全なユーザーフローの手動テスト
    - ホームページから商品一覧を表示する
    - 商品をクリックして詳細ページに移動する
    - 4 つのプラットフォームの価格比較を表示する
    - アフィリエイトリンクをクリックして外部サイトに移動する
    - _Requirements: 1.2, 1.3, 2.3, 3.1, 4.2_

  - [x] 16.2 価格更新フローのテスト
    - UpdatePricesFunction を手動でトリガーする
    - 全プラットフォームから価格が正常に取得されることを確認する
    - DynamoDB に価格データが保存されることを確認する
    - フロントエンドに更新された価格が表示されることを確認する
    - _Requirements: 2.1, 2.4, 6.2_

  - [x] 16.3 エラーシナリオのテスト
    - ネットワークエラーをシミュレートする
    - 商品が見つからないケースをテストする
    - プラットフォームが利用できないケースをテストする
    - エラーメッセージとフォールバック動作を確認する
    - _Requirements: 1.4, 2.3, 2.5_

- [x] 17. モニタリングとロギングの設定
  - [x] 17.1 CloudWatch ダッシュボードの作成
    - Lambda 関数のメトリクス（呼び出し、エラー、期間）を追加する
    - API Gateway のメトリクス（リクエスト、レイテンシ、エラー）を追加する
    - DynamoDB のメトリクス（読み取り/書き込み容量）を追加する
    - _Requirements: 7.2_

  - [x] 17.2 CloudWatch アラームの設定
    - Lambda 関数のエラー率アラームを作成する
    - API Gateway 5xx エラーアラームを作成する
    - 価格更新失敗アラームを作成する
    - _Requirements: 7.4_

  - [x] 17.3 構造化ロギングの実装
    - Lambda 関数に構造化ロギングを追加する
    - リクエスト ID、タイムスタンプ、コンテキストを含める
    - _Requirements: 7.4_

- [x] 18. ドキュメントとデプロイメントガイドの作成
  - プロジェクト構造、アーキテクチャ、デプロイメント手順を説明する README.md を作成する
  - アフィリエイト ID 設定手順を文書化する
  - ローカル開発セットアップ手順を文書化する
  - _Requirements: 4.1_
